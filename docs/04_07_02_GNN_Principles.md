# GNN의 기본 원리: 메시지 전달

**그래프 신경망(GNN)**의 핵심 아이디어는 그래프의 각 노드가 자신의 정보와 **이웃 노드들의 정보를 반복적으로 집계하여** 자신의 표현(representation)을 업데이트하는 것입니다. 이 과정을 통해 노드는 자신의 지역적인 이웃(local neighborhood)을 넘어, 그래프 전체의 구조적인 정보를 점차적으로 반영하게 됩니다.

이러한 핵심 원리를 **메시지 전달(Message Passing)** 또는 **이웃 집계(Neighborhood Aggregation)**라고 부릅니다.

## 1. 메시지 전달 과정

메시지 전달 패러다임은 크게 세 단계로 구성되며, 이 과정은 GNN의 각 레이어에서 반복적으로 수행됩니다.

### 1단계: 메시지 생성 (Message Generation)
- 각 노드는 자신의 이웃 노드들에게 전달할 **메시지**를 생성합니다.
- 가장 간단한 형태의 메시지는 이웃 노드의 특징 벡터(feature vector) 그 자체일 수 있습니다.
- 더 복잡한 모델에서는, 현재 노드의 특징과 이웃 노드의 특징, 그리고 둘을 연결하는 엣지의 특징을 모두 고려하여 메시지를 생성할 수 있습니다.
  - 예: 노드 `u`가 이웃 노드 `v`에게 보낼 메시지 $m_{uv}$ 생성

### 2단계: 메시지 집계 (Message Aggregation)
- 각 노드는 자신에게 전달된 모든 이웃 노드들의 메시지를 하나의 벡터로 **집계(aggregate)**합니다.
- 이웃 노드의 수는 노드마다 다르기 때문에, 어떤 순서로 집계하든 결과가 동일한 연산(permutation-invariant)이 사용되어야 합니다.
- 주로 사용되는 집계 함수:
  - **Sum:** 모든 메시지 벡터를 더합니다.
  - **Mean:** 모든 메시지 벡터의 평균을 계산합니다.
  - **Max:** 모든 메시지 벡터의 각 차원에서 최댓값을 선택합니다.
  - 예: 노드 `v`는 자신의 모든 이웃 `u`로부터 받은 메시지 $m_{uv}$를 집계하여 $m_v$를 만듭니다. ($m_v = \text{AGGREGATE}(\{m_{uv} | u \in \text{Neighbors}(v)\})$)

### 3단계: 노드 표현 업데이트 (Node Representation Update)
- 각 노드는 집계된 메시지($m_v$)와 자기 자신의 이전 레이어 표현($h_v^{k-1}$)을 결합하여, 현재 레이어의 새로운 표현($h_v^k$)을 **업데이트**합니다.
- 이 과정은 보통 신경망 레이어(예: 완전 연결 레이어)와 비선형 활성화 함수를 통해 이루어집니다.
  - $h_v^k = \text{UPDATE}(h_v^{k-1}, m_v)$

## 2. GNN 레이어의 역할과 의미

- **1개의 GNN 레이어:** 각 노드는 자신의 직접적인 이웃(1-hop neighbor)들의 정보만을 집계합니다.
- **2개의 GNN 레이어:** 1-hop 이웃들이 이미 그들의 이웃(즉, 원래 노드의 2-hop neighbor) 정보를 가지고 있으므로, 2개의 레이어를 거치면 각 노드는 2-hop 이웃들의 정보까지 간접적으로 반영하게 됩니다.
- **K개의 GNN 레이어:** 레이어를 K번 쌓으면, 각 노드는 자신으로부터 K 거리만큼 떨어진 노드들의 정보까지 집계할 수 있게 됩니다.

이처럼 GNN 레이어를 깊게 쌓을수록, 각 노드는 더 넓은 범위의 이웃 정보를 반영하여 그래프 전체의 구조적인 문맥을 이해하는 표현을 학습하게 됩니다.

## 3. 학습 목표

이렇게 업데이트된 최종 노드 표현(representation)은 다양한 다운스트림 태스크(downstream task)를 수행하는 데 사용됩니다.
- **노드 분류 (Node Classification):** 각 노드가 어떤 클래스에 속하는지 예측합니다. (예: 소셜 네트워크에서 특정 사용자의 관심사 분류)
- **링크 예측 (Link Prediction):** 두 노드 사이에 엣지가 존재할 확률을 예측합니다. (예: 친구 추천, 상품 추천)
- **그래프 분류 (Graph Classification):** 그래프 전체가 어떤 클래스에 속하는지 예측합니다. (예: 분자 구조가 특정 약효를 가질지 예측)

GNN은 이러한 메시지 전달 메커니즘을 통해 불규칙한 그래프 데이터의 구조적 정보를 효과적으로 학습하며, 다양한 그래프 관련 문제에서 뛰어난 성능을 보이고 있습니다. GCN, GraphSAGE, GAT와 같은 모델들은 이 메시지 전달 과정의 집계 및 업데이트 단계를 어떻게 구체화했는지에 따라 구분됩니다.
