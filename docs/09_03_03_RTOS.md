# 실시간 운영체제 (RTOS): FreeRTOS, Zephyr - 실시간성 보장

**실시간 운영체제(Real-Time Operating System, RTOS)**는 작업(Task)의 처리 결과뿐만 아니라, **정해진 시간(Deadline) 안에 결과를 내는 것을 보장**하는 데 중점을 둔 운영체제입니다. 일반적인 범용 OS(Linux, Windows)가 평균적인 처리 속도를 높이는 것을 목표로 한다면, RTOS는 작업 처리 시간의 **예측 가능성(Predictability)**과 **결정성(Determinism)**을 확보하는 것을 최우선 목표로 합니다.

로봇 공학, 특히 자율주행차, 드론, 정밀한 산업용 로봇 팔처럼 아주 작은 시간 오차가 시스템 전체의 안정성에 치명적인 영향을 미칠 수 있는 분야에서 RTOS는 필수적인 요소입니다.

## 1. 왜 RTOS가 필요한가?

일반적인 OS 환경(예: 아두이노의 기본 `loop()` 함수, 또는 bare-metal 프로그래밍)에서는 여러 작업을 동시에 처리하기가 까다롭습니다.
- **순차 처리의 한계:** `delay()` 함수를 사용하면 그 시간 동안 CPU가 다른 어떤 일도 하지 못하고 멈춰버립니다.
- **인터럽트의 복잡성:** 인터럽트를 사용하면 동시 처리가 가능하지만, 작업의 우선순위가 복잡해지면 관리하기가 매우 어렵고, 긴급한 작업이 덜 중요한 작업 때문에 지연될 수 있습니다.

**RTOS는 이러한 문제를 해결하기 위해 다음과 같은 기능을 제공합니다.**
- **멀티태스킹:** 여러 작업을 독립적인 '태스크(Task)'로 분리하여 동시에 실행되는 것처럼 관리합니다.
- **스케줄러 (Scheduler):** 어떤 태스크를 언제, 얼마나 오래 실행할지를 결정합니다. 가장 중요한 작업이 항상 먼저 실행되도록 보장합니다.
- **태스크 간 통신:** 큐(Queue), 세마포어(Semaphore), 뮤텍스(Mutex) 등 동기화된 통신 메커니즘을 제공하여 태스크들이 안전하게 데이터를 주고받고 공유 자원을 관리할 수 있게 합니다.
- **시간 결정성:** 인터럽트 지연 시간(Latency)이나 태스크 전환 시간(Context Switching)이 일정하고 예측 가능하도록 설계되었습니다.

## 2. 주요 RTOS 플랫폼

### 2.1. FreeRTOS

**FreeRTOS**는 임베디드 시스템을 위해 설계된 작고 간단한 RTOS 커널입니다. 아마존(AWS)에서 인수하여 관리하고 있으며, 수많은 MCU 플랫폼에서 지원되는 사실상의 산업 표준 RTOS 중 하나입니다.

- **주요 특징:**
  - **경량성:** 매우 작은 메모리(RAM, ROM) 공간만 차지하므로 리소스가 제한적인 저사양 MCU에서도 쉽게 사용할 수 있습니다.
  - **단순함:** RTOS의 핵심 기능(태스크 관리, 큐, 세마포어 등)에 집중하여 배우고 사용하기가 비교적 쉽습니다.
  - **이식성:** 특정 하드웨어에 대한 의존성이 낮아 다양한 종류의 MCU에 쉽게 이식할 수 있습니다.
  - **성숙도 및 안정성:** 오랜 기간 동안 수많은 상용 제품에 적용되어 안정성이 검증되었습니다.
  - **AWS IoT 통합:** AWS IoT 서비스와 쉽게 통합하여 클라우드 기반의 관리 및 업데이트 기능을 구현할 수 있습니다.

- **적용 사례:** 모터 제어, 센서 데이터 수집, 통신 프로토콜 처리 등 여러 작업을 안정적으로 동시에 처리해야 하는 대부분의 임베디드 로봇 시스템에 적합합니다.

### 2.2. Zephyr Project

**Zephyr**는 리눅스 재단(Linux Foundation)이 주관하는 오픈소스 협업 프로젝트로, 안전하고 보안이 강화된 연결형(Connected) 기기를 위한 차세대 RTOS를 목표로 합니다.

- **주요 특징:**
  - **높은 설정 유연성(Configurability):** Kconfig 시스템을 통해 커널의 기능들을 매우 세밀하게 설정할 수 있습니다. 사용하지 않는 기능은 컴파일에서 제외하여 메모리 사용량을 최적화할 수 있습니다.
  - **강력한 하드웨어 지원:** 350개 이상의 보드를 공식적으로 지원하며, 다양한 센서와 주변기기에 대한 드라이버를 기본적으로 제공합니다.
  - **통합된 네트워크 및 보안 스택:** 블루투스 LE, Wi-Fi, LoRaWAN 등 다양한 무선 통신 프로토콜 스택과 암호화 라이브러리 등 보안 기능을 처음부터 고려하여 설계했습니다.
  - **안전 인증(Safety-Critical) 지향:** 기능 안전(Functional Safety) 표준 인증을 목표로 개발되고 있어, 자동차나 의료 기기 등 높은 수준의 신뢰성이 요구되는 시스템에 적합합니다.
  - **ROS 2 / micro-ROS 와의 긴밀한 통합:** Zephyr는 micro-ROS가 공식적으로 지원하는 주요 RTOS 중 하나입니다.

## 3. RTOS와 micro-ROS

**micro-ROS**는 리소스가 제한된 마이크로컨트롤러 환경에서 ROS 2 노드를 직접 실행할 수 있게 해주는 프레임워크입니다.
- **RTOS 기반 동작:** micro-ROS는 안정적인 멀티태스킹과 실시간 통신을 위해 FreeRTOS나 Zephyr와 같은 RTOS 위에서 동작하는 것을 표준으로 삼고 있습니다.
- **예시:**
  - **태스크 1:** IMU 센서 데이터를 읽고 필터링하는 작업 (높은 우선순위)
  - **태스크 2:** 모터 PID 제어를 수행하는 작업 (높은 우선순위)
  - **태스크 3:** micro-ROS 통신을 처리하고, `/imu`와 `/odom` 토픽을 발행하는 작업 (중간 우선순위)
  - **태스크 4:** 상태 LED를 깜빡이는 작업 (낮은 우선순위)
RTOS 스케줄러는 이 태스크들을 우선순위에 따라 관리하여, 통신이 지연되더라도 모터 제어나 센서 데이터 처리는 정해진 시간 안에 반드시 수행되도록 보장합니다.

## 결론

단순히 `delay()`를 사용하는 프로그래밍에서 벗어나 RTOS를 도입하는 것은 임베디드 시스템의 수준을 한 단계 끌어올리는 중요한 과정입니다. 특히 둘 이상의 작업을 동시에, 그리고 안정적으로 처리해야 하는 로봇 시스템에서 RTOS는 더 이상 선택이 아닌 필수 기술에 가깝습니다.

- **FreeRTOS**는 작고 검증된 솔루션이 필요할 때 좋은 선택입니다.
- **Zephyr**는 다양한 하드웨어 지원과 강력한 설정 기능, 최신 기술 통합이 필요할 때 더 나은 선택이 될 수 있습니다.

어떤 RTOS를 선택하든, RTOS의 기본 개념(태스크, 스케줄링, 동기화)을 이해하는 것은 로봇의 안정성과 성능을 극대화하는 데 핵심적인 역할을 합니다.
