# 마이크로컨트롤러 (MCU): Arduino, STM32 등 펌웨어 개발

**마이크로컨트롤러(Microcontroller Unit, MCU)**는 로봇의 가장 낮은 레벨에서 하드웨어를 직접 제어하는 역할을 하는 작은 컴퓨터입니다. 모터 드라이버, 센서, LED 등 전자 부품과 직접 연결되어 실시간으로 신호를 읽고 출력하는 작업을 담당합니다. ROS와 같은 고수준 시스템이 로봇의 '뇌' 역할을 한다면, MCU는 로봇의 '신경계' 역할을 수행합니다.

이 문서에서는 로봇 공학에서 널리 사용되는 대표적인 MCU 플랫폼인 Arduino와 STM32에 대해 알아봅니다.

## 1. 마이크로컨트롤러의 역할

- **실시간 제어:** 모터의 PID 제어, 센서 데이터의 빠른 필터링 등 수십 마이크로초(μs)에서 밀리초(ms) 단위의 정밀하고 반복적인 작업은 일반적인 운영체제(Linux, Windows)보다 MCU가 훨씬 더 안정적으로 수행할 수 있습니다.
- **하드웨어 인터페이스:** GPIO, ADC, PWM, I2C, SPI, UART와 같은 저수준 하드웨어 통신 프로토콜을 직접 처리하여 각종 센서와 액추에이터를 구동합니다.
- **전력 효율성:** 고성능 컴퓨터(SBC)에 비해 전력 소모가 매우 적어, 로봇의 전체 작동 시간을 늘리는 데 기여합니다.
- **안정성 및 독립성:** 메인 컴퓨터가 다운되더라도 MCU는 독립적으로 비상 정지나 기본적인 안전 동작을 수행하도록 프로그래밍할 수 있습니다.

## 2. Arduino

**아두이노(Arduino)**는 오픈소스 하드웨어 및 소프트웨어 플랫폼으로, 비전공자도 쉽게 임베디드 시스템에 입문할 수 있도록 만들어졌습니다. 간결한 개발 환경과 풍부한 라이브러리, 거대한 커뮤니티 덕분에 프로토타이핑 및 교육용으로 압도적인 인기를 자랑합니다.

- **주요 특징:**
  - **쉬운 사용법:** C++를 단순화한 아두이노 언어와 직관적인 아두이노 IDE(통합 개발 환경)를 통해 몇 줄의 코드만으로 LED를 켜거나 모터를 돌리는 등의 작업을 쉽게 수행할 수 있습니다.
  - **방대한 라이브러리 및 예제:** 거의 모든 종류의 센서와 액추에이터에 대한 라이브러리와 예제 코드가 공개되어 있어, 원하는 기능을 빠르게 구현할 수 있습니다.
  - **풍부한 하드웨어 생태계:** 아두이노 보드에 쉽게 꽂아서 사용할 수 있는 '쉴드(Shield)' 형태의 확장 보드들이 많아 기능 확장이 용이합니다.
  - **ROS와의 연동:** `rosserial` 라이브러리를 사용하면 아두이노와 ROS 시스템이 시리얼 통신(USB)을 통해 토픽, 서비스 등을 주고받을 수 있습니다. 이를 통해 아두이노가 ROS의 센서/액추에이터 노드 역할을 수행하게 할 수 있습니다.

- **대표 보드:**
  - **Arduino Uno:** 가장 기본적이고 널리 사용되는 입문용 보드.
  - **Arduino Nano:** Uno와 성능은 비슷하지만 크기가 매우 작은 보드.
  - **Arduino Mega:** 더 많은 I/O 핀과 메모리를 가진 고성능 보드.

- **단점:**
  - 8비트 기반의 저사양 MCU(ATmega328)를 사용하는 경우가 많아, 복잡하고 빠른 연산에는 한계가 있습니다.
  - 전문적인 디버깅 기능이 부족합니다.

## 3. STM32

**STM32**는 STMicroelectronics사에서 제작하는 **ARM Cortex-M** 코어 기반의 고성능 32비트 MCU 시리즈입니다. 아두이노보다 훨씬 뛰어난 성능과 다양한 주변기기(Peripherals)를 내장하고 있어, 취미 수준을 넘어 상용 제품 및 고성능 로봇 개발에 널리 사용됩니다.

- **주요 특징:**
  - **고성능:** 32비트 ARM 코어를 기반으로 하여 부동소수점 연산(FPU) 및 복잡한 계산을 아두이노보다 훨씬 빠르게 처리할 수 있습니다.
  - **풍부한 주변기기:** 고성능 타이머(Advanced Timer), 여러 채널의 ADC/DAC, CAN, DMA(Direct Memory Access) 등 전문적인 제어에 필요한 고급 기능들을 하드웨어적으로 지원합니다.
  - **전문적인 개발 환경:** Keil, IAR, STM32CubeIDE와 같은 전문 통합 개발 환경(IDE)을 사용하며, ST-Link와 같은 하드웨어 디버거를 통해 코드의 단계별 실행, 변수 값 확인 등 강력한 디버깅이 가능합니다.
  - **다양한 라인업:** 저전력에 특화된 L 시리즈부터 초고성능의 H 시리즈까지 매우 폭넓은 제품 라인업을 갖추고 있어, 프로젝트의 요구사항에 정확히 맞는 MCU를 선택할 수 있습니다.
  - **ROS와의 연동:** `micro-ROS`를 사용하면 RTOS(실시간 운영체제) 위에서 ROS 2 노드를 직접 실행할 수 있습니다. 이는 `rosserial`보다 훨씬 안정적이고 효율적인 통신을 가능하게 합니다.

- **대표 보드 (Nucleo, Discovery 시리즈):**
  - **Nucleo-F446RE:** 강력한 성능과 아두이노와 유사한 핀 헤더를 갖추고 있어 입문용으로 많이 사용되는 보드.
  - **Blue Pill (비공식):** 매우 저렴한 가격의 STM32F103 기반 보드.

- **단점:**
  - 아두이노에 비해 초기 설정(레지스터, 클럭 설정 등)이 복잡하고 학습 곡선이 가파릅니다. (STM32CubeMX와 같은 코드 생성 도구가 이를 많이 완화해 줍니다.)
  - 커뮤니티나 라이브러리가 아두이노만큼 초보자 친화적이지는 않습니다.

## 4. 선택 가이드

| 구분 | Arduino | STM32 |
| --- | --- | --- |
| **목표** | 빠른 프로토타이핑, 교육, 간단한 취미 프로젝트 | 고성능/고정밀 제어, 상용 제품, 복잡한 시스템 |
| **성능** | 낮음 (주로 8-bit) | 높음 (32-bit ARM Cortex-M) |
| **사용 난이도** | 매우 쉬움 | 어려움 (학습 곡선 가파름) |
| **개발 환경** | Arduino IDE (간단함) | STM32CubeIDE, Keil 등 (전문적, 복잡함) |
| **디버깅** | 제한적 (시리얼 출력 의존) | 강력함 (하드웨어 디버거 사용) |
| **ROS 연동** | `rosserial` (간단하지만 성능 제한) | `micro-ROS` (고성능, RTOS 필요) |

로봇 개발에서는 **"적재적소"**의 원칙이 중요합니다. 단순히 LED를 켜거나 간단한 센서 값을 읽는 데는 아두이노가 훨씬 효율적이며, 여러 개의 모터를 정밀하게 동기화하여 제어하거나 복잡한 연산이 필요한 경우에는 STM32가 필수적입니다. 많은 로봇 시스템에서는 고성능 SBC(예: Raspberry Pi)와 여러 개의 MCU(Arduino, STM32 등)가 각자의 역할에 맞게 작업을 분담하는 하이브리드 구조를 채택합니다.
