# 뉴턴-오일러 방정식 기반 모델링 (Newton-Euler Formulation)

**뉴턴-오일러 방정식(Newton-Euler Formulation)**은 로봇의 동역학 모델을 수립하는 또 다른 주요 방법입니다. 이 방법은 라그랑주 역학이 시스템 전체의 에너지를 다루는 것과 달리, 로봇의 각 **링크(Link)**에 개별적으로 작용하는 **힘(Force)**과 **모멘트(Moment)**를 직접 계산하여 운동 방정식을 유도합니다.

이 방법은 특히 **역동역학(Inverse Dynamics)** 문제, 즉 주어진 로봇의 궤적(위치, 속도, 가속도)을 따라 움직이기 위해 필요한 관절 토크(`τ`)를 계산하는 데 매우 효율적입니다.

## 핵심 원리: 뉴턴-오일러 방정식

뉴턴-오일러 방정식은 강체(Rigid Body)의 운동을 기술하는 두 가지 기본 법칙에 기반합니다.

1.  **뉴턴 제2법칙 (선형 운동):** 물체의 질량중심(Center of Mass)에 작용하는 모든 힘의 합(`F`)은 질량(`m`)과 질량중심의 선형 가속도(`a_c`)의 곱과 같다.
    `F = m * a_c`

2.  **오일러 방정식 (회전 운동):** 물체의 질량중심에 작용하는 모든 모멘트의 합(`N`)은 물체의 관성 텐서(`I_c`)와 각가속도(`α`), 그리고 각속도(`ω`)에 의한 자이로스코픽 항의 합과 같다.
    `N = I_c * α + ω × (I_c * ω)`

## 뉴턴-오일러 알고리즘 (Recursive Newton-Euler Algorithm)

뉴턴-오일러 방법은 이 두 방정식을 로봇의 각 링크에 대해 재귀적으로 적용하여 관절 토크를 계산합니다. 알고리즘은 두 단계의 순회(Pass)로 구성됩니다.

### 1. 순방향 순회 (Forward Pass / Outward Pass): 링크 0(베이스) → 링크 n(엔드 이펙터)

베이스부터 시작하여 엔드 이펙터 방향으로 각 링크의 속도와 가속도를 순차적으로 계산합니다. 즉, `i-1`번째 링크의 운동 정보를 바탕으로 `i`번째 링크의 운동 정보를 계산합니다.

- **입력:** 이전 링크(`i-1`)의 각속도(`ωᵢ₋₁`), 각가속도(`αᵢ₋₁`), 선형 가속도(`aᵢ₋₁`) 및 현재 관절의 속도(`q̇ᵢ`)와 가속도(`q̈ᵢ`).
- **계산:**
  - **`i`번째 링크의 각속도 (`ωᵢ`):** `ωᵢ₋₁` + 관절 `i`의 회전으로 인한 각속도 변화
  - **`i`번째 링크의 각가속도 (`αᵢ`):** `αᵢ₋₁` + 관절 `i`의 회전으로 인한 각가속도 변화
  - **`i`번째 링크의 질량중심의 선형 가속도 (`a_ci`):** `aᵢ` (링크 원점의 가속도) + `αᵢ`와 `ωᵢ`에 의한 가속도
- **출력:** 모든 링크의 각속도, 각가속도, 선형 가속도.

### 2. 역방향 순회 (Backward Pass / Inward Pass): 링크 n(엔드 이펙터) → 링크 0(베이스)

엔드 이펙터부터 시작하여 베이스 방향으로 각 링크에 작용하는 힘과 모멘트를 계산하고, 이를 통해 최종적으로 각 관절에 필요한 토크를 계산합니다. 즉, `i+1`번째 링크에서 `i`번째 링크로 전달되는 힘과 모멘트를 바탕으로 관절 `i`의 토크를 계산합니다.

- **입력:** 다음 링크(`i+1`)가 현재 링크(`i`)에 가하는 힘(`fᵢ₊₁`)과 모멘트(`nᵢ₊₁`). (엔드 이펙터에 외부 힘/모멘트가 없다면 `fₙ₊₁=0`, `nₙ₊₁=0`에서 시작)
- **계산:**
  - **링크 `i`에 작용하는 총 힘 (`fᵢ`):** 뉴턴 방정식을 이용. (`fᵢ = fᵢ₊₁ + mᵢ * a_ci`)
  - **링크 `i`에 작용하는 총 모멘트 (`nᵢ`):** 오일러 방정식을 이용.
  - **관절 `i`의 토크 (`τᵢ`):** 계산된 힘 `fᵢ`와 모멘트 `nᵢ`를 관절 축 `Zᵢ₋₁`에 대해 투영하여 계산.
- **출력:** 모든 관절에 필요한 토크 벡터 `τ`.

## 장점 및 단점

### 장점
- **계산 효율성:** 재귀적인 구조 덕분에 계산량이 자유도 `n`에 대해 선형적으로 증가(`O(n)`)합니다. 이는 자유도가 높은 로봇의 동역학을 실시간으로 계산하는 데 매우 효율적입니다. 라그랑주 방법이 `O(n⁴)`의 계산 복잡도를 갖는 것과 대조적입니다.
- **물리적 직관:** 각 링크에 작용하는 힘과 모멘트를 직접 계산하므로, 물리적인 의미를 직관적으로 이해하기 쉽습니다.

### 단점
- **순동역학 계산의 비효율성:** 순동역학(토크가 주어졌을 때 가속도를 계산)을 풀기 위해서는 `τ = M(q)q̈ + C(q, q̇)q̇ + G(q)` 형태의 방정식을 `q̈`에 대해 풀어야 합니다. 뉴턴-오일러 방법은 `M, C, G` 항을 직접 제공하지 않으므로, 이들을 별도로 계산해야 하는 번거로움이 있습니다.
- **제어 분석의 어려움:** 알고리즘이 절차적으로 기술되어 있어, 라그랑주 방법처럼 동역학 모델의 구조적 특성(대칭성, 양의 정부호성 등)을 분석하고 제어 법칙을 설계하는 데는 상대적으로 불리합니다.

결론적으로, **뉴턴-오일러 방법**은 실시간 역동역학 계산에 매우 강력하고 효율적인 도구이며, **라그랑주 방법**은 동역학 모델의 수학적 구조를 분석하고 제어 이론을 개발하는 데 더 유용합니다. 두 방법은 서로 다른 장단점을 가지며 상호 보완적으로 사용됩니다.
