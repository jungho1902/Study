# ROS 2 핵심 개념

ROS 2는 로봇 애플리케이션을 구성하는 여러 프로그램(노드)들이 서로 통신할 수 있도록 지원하는 프레임워크입니다. 이러한 통신은 토픽, 서비스, 액션이라는 세 가지 주요 메커니즘을 통해 이루어집니다. 이 문서는 ROS 2의 가장 기본적인 구성 요소인 노드와 세 가지 통신 방식에 대해 설명합니다.

## 1. 노드 (Nodes)

**노드(Node)**는 ROS 2 시스템에서 실행되는 가장 작은 단위의 프로세스입니다. 각 노드는 특정한 단일 목적을 수행하도록 설계됩니다. 예를 들어, 로봇 시스템은 다음과 같은 여러 노드로 구성될 수 있습니다.

- 카메라로부터 이미지를 받아오는 노드
- 라이다(LiDAR) 센서 데이터를 처리하는 노드
- 바퀴 모터를 제어하는 노드
- 현재 로봇의 위치를 추정하는 노드
- 로봇의 이동 경로를 계획하는 노드

이렇게 기능을 잘게 나누어 모듈화하면 시스템의 특정 부분을 독립적으로 개발하고 테스트하며 재사용하기 용이해집니다. 노드들은 ROS 2의 통신 시스템을 통해 서로 데이터를 주고받으며 하나의 통합된 로봇 애플리케이션으로 동작합니다.

## 2. ROS 2 통신 방식 (Communication Types)

ROS 2의 통신은 DDS(Data Distribution Service)를 기반으로 하며, 크게 세 가지 방식으로 나뉩니다.

![ROS 2 Communication](https-i-imgur-com-y91234-png)
*(실제 이미지 대신 설명을 위한 예시입니다. ROS 2의 통신 방식을 시각적으로 표현)*

### 2.1. 토픽 (Topics)

**토픽(Topic)**은 **지속적인 데이터 스트림**을 비동기적으로 주고받는 **일대다(one-to-many)** 통신 방식입니다. 데이터를 발행(Publish)하는 노드(Publisher)와 데이터를 구독(Subscribe)하는 노드(Subscriber)가 존재합니다.

- **특징:**
  - **비동기(Asynchronous):** 발행자는 구독자가 데이터를 받았는지 확인하지 않고 계속해서 메시지를 보냅니다.
  - **다대다(Many-to-Many):** 하나의 토픽에 여러 발행자와 여러 구독자가 연결될 수 있습니다.
  - **메시지(Message):** 토픽을 통해 주고받는 데이터의 구조를 `.msg` 파일에 정의합니다. (예: `geometry_msgs/msg/Twist`)

- **사용 예시:**
  - `/image_raw`: 카메라 드라이버 노드가 지속적으로 이미지 데이터를 발행.
  - `/odom`: 위치 추정 노드가 로봇의 주행 기록(odometry) 정보를 계속해서 발행.
  - `/cmd_vel`: 제어 노드가 로봇의 목표 속도 명령을 발행.

### 2.2. 서비스 (Services)

**서비스(Service)**는 **요청(Request)과 응답(Response)**이 동기적으로 이루어지는 **일대일(one-to-one)** 통신 방식입니다. 서비스를 제공하는 서버(Server)와 서비스를 요청하는 클라이언트(Client)로 구성됩니다.

- **특징:**
  - **동기(Synchronous):** 클라이언트는 서버로부터 응답이 올 때까지 기다립니다. (Blocking call)
  - **일대일(One-to-One):** 특정 클라이언트의 요청은 하나의 서버에 의해 처리되고, 응답은 해당 클라이언트에게만 전달됩니다.
  - **서비스 데이터 타입:** 요청과 응답의 데이터 구조를 `.srv` 파일에 정의합니다.

- **사용 예시:**
  - `/set_camera_info`: 카메라의 설정을 변경해달라고 요청하고, 성공 여부를 응답받음.
  - `/clear_costmaps`: 내비게이션 시스템의 비용 지도를 초기화해달라고 요청.
  - `/spawn_entity`: 시뮬레이션 환경에 새로운 로봇이나 물체를 생성해달라고 요청.

### 2.3. 액션 (Actions)

**액션(Action)**은 **장시간 실행되는 목표(Goal)**를 비동기적으로 처리하고, **지속적인 피드백(Feedback)**과 **최종 결과(Result)**를 제공하는 통신 방식입니다. 액션을 제공하는 액션 서버(Action Server)와 목표를 요청하는 액션 클라이언트(Action Client)로 구성됩니다.

- **특징:**
  - **비동기(Asynchronous):** 클라이언트는 목표를 보낸 후 다른 작업을 계속할 수 있으며, 중간 피드백을 받을 수 있습니다.
  - **취소 가능(Preemptible):** 클라이언트는 진행 중인 목표를 언제든지 취소할 수 있습니다.
  - **피드백 제공:** 서버는 목표를 달성하는 동안 현재 진행 상태(예: 이동한 거리, 남은 시간)를 클라이언트에게 지속적으로 보낼 수 있습니다.
  - **액션 데이터 타입:** 목표, 결과, 피드백의 데이터 구조를 `.action` 파일에 정의합니다.

- **사용 예시:**
  - `/navigate_to_pose`: 내비게이션 시스템에 특정 좌표로 이동하라는 목표를 전달. 서버는 이동하는 동안 현재 위치를 피드백으로 보내고, 도착 시 성공 여부를 결과로 반환.
  - `/rotate_absolute`: 로봇 팔을 특정 각도로 회전시키라는 목표를 전달.
  - `/backup`: 로봇을 일정 거리만큼 후진시키는 목표를 전달.

## 3. 파라미터 (Parameters)

**파라미터(Parameter)**는 노드가 실행 중에 외부에서 설정하거나 변경할 수 있는 **설정값**입니다. 각 노드는 자신만의 파라미터를 가질 수 있으며, 이를 통해 코드 수정 없이 노드의 동작을 유연하게 변경할 수 있습니다.

- **특징:**
  - **동적 재설정(Dynamic Reconfigure):** 노드가 실행되는 동안에도 파라미터 값을 변경할 수 있습니다.
  - **타입 지원:** 문자열, 정수, 실수, 불리언 등 다양한 데이터 타입을 지원합니다.
  - **저장 및 로드:** 파라미터 값들을 YAML 파일에 저장하고, 노드 실행 시 불러올 수 있습니다.

- **사용 예시:**
  - 카메라 노드의 해상도(`width`, `height`) 설정
  - 제어 노드의 PID 게인(`kp`, `ki`, `kd`) 값 조절
  - 내비게이션 노드의 최대 속도(`max_velocity`) 제한

## 요약

| 통신 방식 | 주 용도 | 통신 형태 | 동기/비동기 |
| --- | --- | --- | --- |
| **토픽** | 센서 데이터, 상태 정보 등 연속적인 데이터 스트림 | Publish/Subscribe | 비동기 |
| **서비스** | 특정 작업을 즉시 처리하고 결과를 받아야 할 때 | Request/Response | 동기 |
| **액션** | 시간이 오래 걸리는 작업을 실행하고 중간 피드백을 원할 때 | Goal/Feedback/Result | 비동기 |

이러한 핵심 개념들을 이해하는 것은 ROS 2 기반의 로봇 시스템을 설계하고 개발하는 데 있어 가장 중요한 첫걸음입니다.
