# 자코비안 (Jacobian)

**자코비안(Jacobian)** 또는 **자코비 행렬(Jacobian Matrix)**은 로봇의 관절 공간(Joint Space)에서의 속도와 직교 좌표 공간(Cartesian Space)에서의 속도 사이의 관계를 나타내는 행렬입니다. 즉, 각 관절이 얼마나 빨리 움직일 때 로봇의 끝점(End-Effector)이 어떤 선속도(Linear Velocity)와 각속도(Angular Velocity)로 움직이는지를 매핑(mapping)해주는 역할을 합니다.

- **입력:** 각 관절의 속도 (q̇)
- **출력:** 엔드 이펙터의 선속도 (v) 및 각속도 (ω)
- **관계식:** `ẋ = J(q) * q̇`
  - `ẋ`: 엔드 이펙터의 속도 벡터 `[v; ω]` (6x1)
  - `J(q)`: 현재 관절 각도(q)에 따라 달라지는 자코비안 행렬 (6xN, N은 관절 수)
  - `q̇`: 관절 속도 벡터 `[dq₁/dt, dq₂/dt, ...]` (Nx1)

## 자코비안의 구성

자코비안 행렬 `J`는 6xN 크기를 가지며, 상단 3개 행은 선속도에, 하단 3개 행은 각속도에 대한 관계를 나타냅니다.

```
      | J_v |  <- 선속도(Linear Velocity) 부분
J =   |-----|
      | J_ω |  <- 각속도(Angular Velocity) 부분
```

- `J_v` (3xN): 각 관절의 움직임이 엔드 이펙터의 선속도 `v`에 미치는 영향
- `J_ω` (3xN): 각 관절의 움직임이 엔드 이펙터의 각속도 `ω`에 미치는 영향

각 열(Column)은 `i`번째 관절이 엔드 이펙터의 속도에 얼마나 기여하는지를 나타냅니다.

## 자코비안의 주요 활용 분야

### 1. 속도 기구학 (Velocity Kinematics)

자코비안의 가장 기본적인 역할입니다.
- **순기구학적 속도 분석:** 관절 속도(`q̇`)를 알 때, 엔드 이펙터의 속도(`ẋ`)를 계산할 수 있습니다.
  `ẋ = J(q) * q̇`
- **역기구학적 속도 분석:** 원하는 엔드 이펙터 속도(`ẋ`)를 만들기 위해 필요한 관절 속도(`q̇`)를 계산할 수 있습니다. 이를 위해서는 자코비안의 역행렬(`J⁻¹`)이 필요합니다.
  `q̇ = J⁻¹(q) * ẋ`

### 2. 수치적 역기구학 해법 (Numerical Inverse Kinematics)

해석적으로 역기구학을 풀기 어려운 경우, 자코비안을 이용한 반복적인 수치 해법을 사용합니다. 현재 위치와 목표 위치 사이의 오차(`Δx`)를 계산하고, 이 오차를 줄이기 위해 필요한 관절의 변화량(`Δq`)을 `Δq = J⁻¹ * Δx` 와 같이 계산하여 관절 각도를 점진적으로 업데이트합니다.

### 3. 특이점 분석 (Singularity Analysis)

**특이점(Singularity)**은 로봇이 특정 자세를 취했을 때 자코비안 행렬의 행렬식(Determinant)이 0이 되어 역행렬이 존재하지 않는 상태를 의미합니다.
- `det(J(q)) = 0`
- **물리적 의미:**
  - 로봇이 특정 방향으로 움직일 수 없게 되어 자유도를 잃습니다.
  - 특정 방향으로 움직이기 위해 무한대의 관절 속도가 필요하게 됩니다.
  - 외부 힘에 대해 매우 큰 내부 힘이 발생하여 로봇에 무리를 줄 수 있습니다.
- **종류:**
  - **작업 공간 경계 특이점 (Workspace Boundary Singularity):** 로봇 팔이 완전히 펴졌을 때.
  - **작업 공간 내부 특이점 (Workspace Interior Singularity):** 로봇 손목의 축들이 일직선이 될 때.
- 자코비안을 분석하면 이러한 특이점을 미리 예측하고 회피하는 경로를 계획할 수 있습니다.

### 4. 정적 힘 분석 (Static Force Analysis)

자코비안은 속도뿐만 아니라 힘의 관계를 분석하는 데도 사용됩니다. **가상일의 원리(Principle of Virtual Work)**에 의해, 엔드 이펙터에 가해지는 힘/토크(`F`)와 각 관절에 필요한 토크(`τ`) 사이에는 다음과 같은 관계가 성립합니다.

`τ = Jᵀ(q) * F`

- `τ`: 관절 토크 벡터 (Nx1)
- `Jᵀ`: 자코비안의 전치 행렬 (Transpose of Jacobian)
- `F`: 엔드 이펙터에 작용하는 힘/토크 벡터 `[fx, fy, fz, τx, τy, τz]ᵀ` (6x1)

이 관계를 이용하여 로봇이 특정 물체를 들거나 외부 힘에 저항하기 위해 각 관절 모터가 얼마나 많은 힘(토크)을 내야 하는지 계산할 수 있습니다. 이는 로봇의 힘 제어(Force Control)에 핵심적인 역할을 합니다.
