# 3.2.1. 계층적 군집화 (Hierarchical Clustering)

**계층적 군집화(Hierarchical Clustering)**는 데이터 포인트들 간의 계층적인 관계를 기반으로 군집을 형성하는 알고리즘입니다. K-평균 군집화와 달리, 사전에 군집의 개수(K)를 지정할 필요가 없다는 큰 특징이 있습니다. 대신, 군집화의 전체 과정을 시각화하는 **덴드로그램(Dendrogram)**을 통해 사용자가 원하는 수의 군집을 선택할 수 있습니다.

계층적 군집화는 크게 두 가지 접근 방식으로 나뉩니다.

## 1. 두 가지 접근 방식

### 1.1. 병합적 계층 군집화 (Agglomerative Hierarchical Clustering)

- **"상향식(Bottom-up)"** 접근 방식이며, 가장 널리 사용됩니다.
- **동작 원리**:
  1. **시작**: 각 데이터 포인트를 하나의 개별적인 군집으로 간주합니다. (n개의 데이터 포인트가 있다면 n개의 군집으로 시작)
  2. **병합**: 가장 가까운(유사한) 두 군집을 찾아 하나의 군집으로 합칩니다.
  3. **반복**: 2번 과정을 반복하여, 최종적으로 모든 데이터 포인트가 하나의 거대한 군집이 될 때까지 계속해서 군집을 병합해 나갑니다.

### 1.2. 분할적 계층 군집화 (Divisive Hierarchical Clustering)

- **"하향식(Top-down)"** 접근 방식입니다.
- **동작 원리**:
  1. **시작**: 모든 데이터 포인트를 포함하는 하나의 거대한 군집에서 시작합니다.
  2. **분할**: 가장 이질적인 데이터 포인트들을 포함하는 군집을 두 개의 작은 군집으로 분할합니다.
  3. **반복**: 2번 과정을 반복하여, 최종적으로 모든 데이터 포인트가 각각 하나의 군집이 될 때까지 계속해서 군집을 분할해 나갑니다.

일반적으로 분할적 방식은 계산량이 매우 많아 병합적 방식이 더 선호됩니다.

## 2. 덴드로그램 (Dendrogram)

**덴드로그램**은 계층적 군집화의 결과를 시각적으로 표현하는 나무 형태의 다이어그램입니다.

- **y축**: 군집 간의 거리 또는 비유사도를 나타냅니다.
- **x축**: 개별 데이터 포인트를 나타냅니다.

덴드로그램을 통해 어떤 군집들이 어떤 순서로, 그리고 어떤 거리에서 병합되었는지를 한눈에 파악할 수 있습니다. 사용자는 이 덴드로그램을 특정 높이에서 수평으로 잘라, 원하는 개수의 군집을 얻을 수 있습니다. 예를 들어, 덴드로그램을 잘랐을 때 수평선이 3개의 수직선을 가로지르면, 이는 데이터를 3개의 군집으로 나누는 것을 의미합니다.

## 3. 군집 간 거리 측정: 연결 기준 (Linkage Criteria)

두 군집을 병합할 때, "군집 간의 거리"를 어떻게 정의하느냐가 매우 중요합니다. 이 측정 기준을 **연결 기준(Linkage Criteria)**이라고 합니다.

- **단일 연결 (Single Linkage)**: 두 군집에 속한 데이터 포인트 쌍 중에서 **가장 가까운** 거리를 군집 간의 거리로 정의합니다. 군집이 길게 연결되는 '사슬 효과(chaining effect)'가 나타날 수 있습니다.
- **완전 연결 (Complete Linkage)**: 두 군집에 속한 데이터 포인트 쌍 중에서 **가장 먼** 거리를 군집 간의 거리로 정의합니다. 군집의 크기가 비슷한 원형 군집을 만드는 경향이 있습니다.
- **평균 연결 (Average Linkage)**: 두 군집에 속한 **모든 데이터 포인트 쌍**의 평균 거리를 군집 간의 거리로 정의합니다. 단일 연결과 완전 연결의 절충안으로, 안정적인 성능을 보입니다.
- **워드 연결 (Ward's Linkage)**: 두 군집을 병합했을 때, 군집 내 **분산(variance)의 증가량을 최소화**하는 방향으로 군집을 병합합니다. 군집의 크기가 비슷한 군집을 만드는 경향이 있으며, 많이 사용되는 기준 중 하나입니다.

## 4. 계층적 군집화의 장단점

### 장점
- **사전 K값 불필요**: 군집의 개수를 미리 정할 필요가 없습니다.
- **시각화**: 덴드로그램을 통해 군집화 과정과 데이터의 계층 구조를 쉽게 이해할 수 있습니다.
- **다양한 거리/연결 기준**: 데이터의 특성에 맞게 다양한 거리 척도와 연결 기준을 유연하게 적용할 수 있습니다.

### 단점
- **높은 계산 복잡도**: 데이터가 많아질수록 계산량이 기하급수적으로 증가하여(특히 병합적 방식은 O(n³)), 대용량 데이터셋에는 적용하기 어렵습니다.
- **결정 번복 불가**: 한번 군집이 병합되거나 분할되면, 그 결정은 되돌릴 수 없습니다. 이로 인해 초반의 잘못된 결정이 최종 결과에 큰 영향을 미칠 수 있습니다.
- **민감성**: 어떤 거리 척도와 연결 기준을 사용하느냐에 따라 군집 결과가 크게 달라질 수 있습니다.

---

## 예제 및 풀이 (Examples and Solutions)

### 예제 1: 덴드로그램 해석하기

**문제:** 아래 덴드로그램은 6개의 데이터 포인트(a, b, c, d, e, f)에 대한 병합적 계층 군집화의 결과를 보여줍니다. 이 덴드로그램을 해석하여 다음 질문에 답하시오.
1. 가장 먼저 병합되는 두 데이터 포인트는 무엇인가?
2. 이 데이터를 2개의 군집으로 나누려면, 어떤 군집들이 생성되는가?
3. 이 데이터를 3개의 군집으로 나누려면, 어떤 군집들이 생성되는가?

![Dendrogram Example](https://upload.wikimedia.org/wikipedia/commons/thumb/a/a2/Dendrogram.png/330px-Dendrogram.png)
*(이미지 출처: 위키미디어)*

**풀이:**
덴드로그램은 아래에서 위로 올라가며 군집이 어떻게 병합되는지를 보여줍니다. y축의 높이가 낮을수록 먼저 병합된 것을 의미합니다.

1.  **가장 먼저 병합되는 데이터:**
    - 가장 낮은 높이에서 연결된 두 데이터 포인트는 **b와 c** 입니다. 따라서 이 둘이 가장 먼저 하나의 군집을 형성합니다.

2.  **2개의 군집으로 나누기:**
    - 덴드로그램의 가장 상단(가장 높은 y값)에서부터 아래로 내려오면서, 수평선이 2개의 수직선과 만나도록 자릅니다.
    - 그림에서 y축 값 25 근처에서 수평선을 그으면, 선은 (d,e,f)를 묶는 큰 가지와 (a,b,c)를 묶는 큰 가지, 두 개를 가로지릅니다.
    - **생성되는 군집: `{d, e, f}` 와 `{a, b, c}`**

3.  **3개의 군집으로 나누기:**
    - 수평선이 3개의 수직선과 만나도록 더 아래로 내려와서 자릅니다.
    - 그림에서 y축 값 18 근처에서 수평선을 그으면, 선은 (d,e,f)를 묶는 가지, (a) 가지, (b,c)를 묶는 가지, 세 개를 가로지릅니다.
    - **생성되는 군집: `{d, e, f}`, `{a}`, `{b, c}`**

**결론:**
덴드로그램은 군집화의 전체 과정을 시각화하여, 사용자가 데이터의 구조를 보고 원하는 수준에서 군집의 개수를 유연하게 결정할 수 있도록 돕습니다.
