# URDF (Unified Robot Description Format): 로봇 모델 기술

**URDF(Unified Robot Description Format)**는 로봇의 물리적인 구조를 XML 형식으로 기술하기 위한 표준 파일 형식입니다. URDF는 로봇의 각 부분(링크)이 어떻게 생겼고, 이들이 서로 어떻게 연결(조인트)되어 있는지를 정의합니다. ROS에서는 URDF를 사용하여 로봇 모델을 시각화(Rviz2), 시뮬레이션(Gazebo), 운동학/동역학 계산 등에 활용합니다.

## 1. URDF의 핵심 요소: `<link>`와 `<joint>`

URDF 파일은 `<robot>` 태그 안에 여러 개의 `<link>`와 `<joint>` 태그를 포함하는 구조로 이루어집니다.

### 1.1. 링크 (`<link>`)
**링크(Link)**는 로봇의 단단한 몸체 부분을 나타냅니다. 로봇 팔의 한 마디, 바퀴, 카메라 본체 등이 모두 링크에 해당합니다. 링크는 다음과 같은 하위 요소를 가집니다.

- **`<visual>`**: 로봇을 Rviz2와 같은 시각화 도구에서 어떻게 보여줄지를 정의합니다.
  - `<geometry>`: 링크의 모양을 정의합니다. (예: `<box>`, `<cylinder>`, `<sphere>`, `<mesh>`)
  - `<material>`: 링크의 색상이나 텍스처를 정의합니다.
  - `<origin>`: 링크의 기준 좌표계로부터 시각적 요소의 위치와 방향을 설정합니다.

- **`<collision>`**: 시뮬레이터에서 물리적 충돌을 계산할 때 사용되는 링크의 형태를 정의합니다. 보통 시각적 모델(`<visual>`)보다 단순화된 형태(예: 복잡한 메쉬 대신 박스나 실린더)를 사용하여 계산 효율을 높입니다.

- **`<inertial>`**: 링크의 관성 속성(질량, 관성 모멘트)을 정의합니다. 동역학 계산에 필수적인 정보입니다.
  - `<mass>`: 링크의 질량을 kg 단위로 정의합니다.
  - `<inertia>`: 3x3 관성 텐서(Ixx, Ixy, Ixz, Iyy, Iyz, Izz)를 정의합니다.

**예시: 로봇의 몸체 링크 정의**
```xml
<link name="base_link">
  <visual>
    <geometry>
      <cylinder length="0.6" radius="0.2"/>
    </geometry>
    <material name="blue">
      <color rgba="0.0 0.0 1.0 1.0"/>
    </material>
  </visual>
  <collision>
    <geometry>
      <cylinder length="0.6" radius="0.2"/>
    </geometry>
  </collision>
  <inertial>
    <mass value="10"/>
    <inertia ixx="0.4" ixy="0.0" ixz="0.0" iyy="0.4" iyz="0.0" izz="0.2"/>
  </inertial>
</link>
```

### 1.2. 조인트 (`<joint>`)
**조인트(Joint)**는 두 링크를 연결하는 역할을 하며, 이들 사이의 상대적인 움직임을 정의합니다.

- **`<parent link="...">`**: 조인트의 부모 링크를 지정합니다.
- **`<child link="...">`**: 조인트의 자식 링크를 지정합니다.
- **`<origin xyz="..." rpy="...">`**: 부모 링크의 좌표계로부터 자식 링크의 좌표계가 얼마나 떨어져 있는지를 정의합니다. 즉, 조인트의 위치와 방향을 설정합니다.
- **`<axis xyz="...">`**: 조인트의 회전 또는 이동 축을 정의합니다. (주로 `revolute`, `prismatic` 타입에서 사용)
- **`<limit lower="..." upper="..." effort="..." velocity="...">`**: 조인트의 움직임 범위를 제한합니다. (예: 회전 각도, 이동 거리)

**조인트 타입 (`type` 속성):**
- **`revolute`**: 한 축을 중심으로 회전하는 조인트 (예: 로봇 팔 관절, 바퀴)
- **`continuous`**: `revolute`와 같지만 회전 각도에 제한이 없는 조인트
- **`prismatic`**: 한 축을 따라 직선으로 움직이는 조인트 (예: 리니어 액추에이터)
- **`fixed`**: 두 링크를 완전히 고정시키는 조인트. 움직임이 없습니다. (예: 카메라를 로봇 몸체에 고정)
- **`floating`**: 6자유도(3차원 이동 + 3차원 회전)를 모두 허용하는 조인트
- **`planar`**: 평면상에서의 움직임(2차원 이동 + 1차원 회전)을 허용하는 조인트

**예시: 바퀴와 몸체 연결 조인트 정의**
```xml
<joint name="base_to_left_wheel_joint" type="continuous">
  <parent link="base_link"/>
  <child link="left_wheel_link"/>
  <origin xyz="0.0 0.25 0.0" rpy="0 1.5707 1.5707"/>
  <axis xyz="0 0 1"/>
</joint>
```

## 2. Xacro: 더 나은 URDF 작성을 위한 도구

**Xacro(XML Macros)**는 URDF를 더 효율적이고 가독성 좋게 작성할 수 있도록 도와주는 매크로 언어입니다. Xacro를 사용하면 다음과 같은 장점이 있습니다.

- **상수 정의 및 사용:** 로봇의 크기, 질량 등 반복적으로 사용되는 값을 상수로 정의(`<xacro:property>`)하여 재사용성과 유지보수성을 높일 수 있습니다.
- **수학적 표현식:** `${...}` 구문을 사용하여 사칙연산 등 간단한 수학 계산을 포함시킬 수 있습니다.
- **매크로 정의:** 비슷한 구조가 반복될 때(예: 여러 개의 동일한 바퀴) 매크로(`<xacro:macro>`)를 정의하여 코드를 간결하게 만들 수 있습니다.
- **파일 분리 및 포함:** 로봇의 각 부분을 별도의 xacro 파일로 작성하고, 메인 파일에서 포함(`<xacro:include>`)하여 관리할 수 있습니다.

**사용법:**
Xacro 파일(`.urdf.xacro`)은 ROS 노드에서 직접 사용되기 전에 먼저 URDF 파일(`.urdf`)로 변환되어야 합니다. ROS 2 launch 파일에서는 이 과정을 자동으로 처리해주는 기능이 포함되어 있습니다.

## 3. URDF 관련 주요 ROS 패키지

- **`robot_state_publisher`**: `joint_states` 토픽(로봇의 모든 관절 각도 정보)을 구독하고, URDF 모델을 참조하여 각 링크 간의 TF 변환 정보를 계산하고 발행(`tf` 토픽)합니다. Rviz2에서 로봇 모델이 관절 상태에 따라 움직이는 것은 이 노드 덕분입니다.
- **`joint_state_publisher`**: 로봇의 관절 각도를 제어하는 GUI(그래픽 사용자 인터페이스)를 제공합니다. 실제 로봇이 없을 때 `joint_states` 토픽을 임의로 발행하여 로봇 모델을 테스트하는 데 유용합니다.
- **`urdf_tutorial`**: URDF 작성법을 배울 수 있는 간단한 예제들을 포함하고 있습니다.

URDF는 로봇의 형태와 구조를 ROS 생태계 전반에 걸쳐 공유하기 위한 필수적인 형식입니다. 잘 작성된 URDF 파일은 시각화, 시뮬레이션, 제어 알고리즘 개발의 정확성과 효율성을 높이는 기반이 됩니다.
