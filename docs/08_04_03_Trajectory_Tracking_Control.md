# 궤적 추종 제어 (Trajectory Tracking Control)

로봇이 단순히 한 지점에서 다른 지점으로 이동하는 것(Point-to-Point Control)을 넘어, **시간에 따라 정해진 경로(Path)와 속도 프로파일(Velocity Profile)을 정확히 따라 움직이도록** 제어하는 것을 **궤적 추종 제어(Trajectory Tracking Control)**라고 합니다.

- **경로 (Path):** 로봇이 지나가야 할 공간상의 기하학적인 선. (예: 직선, 원, 곡선)
- **궤적 (Trajectory):** 경로에 시간 개념이 추가된 것. 즉, 각 시간 `t`마다 로봇이 있어야 할 위치, 속도, 가속도를 모두 정의한 것입니다.

궤적 추종 제어는 용접, 페인팅, 조립, 자율주행 등 로봇이 정밀하고 동적인 작업을 수행하는 데 필수적인 기술입니다.

## 궤적 추종 제어의 구조

궤적 추종 제어 시스템은 일반적으로 두 가지 주요 부분으로 구성됩니다.

1.  **궤적 생성기 (Trajectory Generator):**
    - 작업의 시작점과 끝점, 그리고 중간 경유점들을 입력받아 로봇이 따라갈 부드러운 궤적(위치, 속도, 가속도)을 시간의 함수로 생성합니다.
    - 로봇의 물리적 한계(최대 속도, 최대 가속도)를 고려하여 실행 가능한 궤적을 만들어야 합니다.
    - 흔히 3차, 5차 다항식 보간(Polynomial Interpolation)이나 B-스플라인(B-Spline)과 같은 곡선 생성 기법이 사용됩니다.

2.  **피드백 제어기 (Feedback Controller):**
    - 매 제어 주기마다 궤적 생성기가 알려주는 **목표 상태(Desired State)**와 로봇의 센서가 측정한 **실제 상태(Actual State)**를 비교합니다.
    - 이 둘 사이의 **추종 오차(Tracking Error)**를 계산하고, 이 오차를 줄이기 위한 제어 입력(토크)을 계산하여 로봇에 명령합니다.

`추종 오차(e) = 목표 위치(q_d) - 실제 위치(q)`
`오차의 미분(ė) = 목표 속도(q̇_d) - 실제 속도(q̇)`

## 주요 궤적 추종 제어 기법

로봇의 동역학 모델을 어떻게 활용하는지에 따라 다양한 제어 기법이 존재합니다.

### 1. 계산된 토크 제어 (Computed Torque Control)

- **개념:** 로봇의 동역학 모델을 제어기 내부에 포함시켜, 시스템의 비선형성을 보상하는 방식입니다. "피드백 선형화(Feedback Linearization)"의 대표적인 예시입니다.
- **제어 법칙:**
  `τ = M(q)(q̈_d + Kp*e + Kv*ė) + C(q, q̇)q̇ + G(q)`
  - `M(q), C(q, q̇), G(q)`: 로봇의 동역학 모델 (관성, 코리올리/원심력, 중력 항)
  - `q̈_d`: 목표 가속도
  - `Kp, Kv`: 제어 이득 (PD 제어기 역할)
- **원리:**
  - 제어기에서 로봇의 동역학(`M, C, G`)을 정확히 계산하여 "상쇄(cancel out)"시킵니다.
  - 이렇게 비선형성이 제거된 시스템은 `q̈ = q̈_d + Kp*e + Kv*ė` 와 같은 간단한 선형 시스템처럼 동작하게 됩니다.
  - 이 선형화된 시스템에 대해 PD 제어(`Kp*e + Kv*ė`)를 적용하여 오차를 0으로 수렴시킵니다.
- **장점:**
  - 이론적으로 오차를 완벽하게 0으로 만들 수 있어 매우 높은 추종 성능을 보입니다.
- **단점:**
  - 로봇의 정확한 동역학 모델(`M, C, G`)을 알아야 합니다.
  - 모델이 부정확하거나 외부 외란이 있는 경우 성능이 저하됩니다.
  - 매 제어 주기마다 복잡한 동역학을 계산해야 하므로 계산량이 많습니다.

### 2. 피드포워드 제어 (Feedforward Control)

- **개념:** 피드백 제어만으로는 궤적을 추종할 때 시간 지연(time lag)으로 인한 오차가 필연적으로 발생합니다. 피드포워드 제어는 이러한 오차를 미리 예측하고 보상하기 위해 목표 궤적을 만드는 데 필요한 토크를 **미리 계산하여** 더해주는 방식입니다.
- **제어 법칙:**
  `τ = τ_ff + τ_fb`
  - `τ_fb`: 피드백 제어기(예: PID)가 계산한 토크. (오차를 줄이는 역할)
  - `τ_ff`: 피드포워드 제어기가 계산한 토크. (목표 궤적을 생성하는 주된 역할)
    - `τ_ff = M(q_d)q̈_d + C(q_d, q̇_d)q̇_d + G(q_d)`
- **원리:**
  - 이상적으로는 피드포워드 토크(`τ_ff`)만으로도 로봇이 목표 궤적을 거의 따라가게 만듭니다.
  - 피드백 제어기(`τ_fb`)는 모델의 불확실성이나 외란으로 인해 발생하는 작은 오차들을 보정하는 보조적인 역할을 수행합니다.
- **장점:**
  - 피드백 제어기의 부담을 크게 줄여주어 추종 성능을 향상시킵니다.
  - 피드백 이득(`Kp, Ki, Kd`)을 높게 설정하지 않아도 되어 안정성을 확보하기 용이합니다.
- **단점:**
  - 계산된 토크 제어와 마찬가지로 로봇의 동역학 모델이 필요합니다.

실제 로봇 시스템에서는 피드포워드 제어와 PID 피드백 제어를 결합한 형태가 널리 사용되어, 높은 추종 성능과 안정성을 동시에 달성합니다.
