# 3.2.1. DBSCAN (Density-Based Spatial Clustering of Applications with Noise)

**DBSCAN**은 **밀도 기반(density-based)** 군집화 알고리즘입니다. K-평균처럼 군집의 모양을 원형으로 가정하지 않고, 데이터가 밀집된 영역을 찾아내어 군집을 형성합니다. 이 덕분에 K-평균으로는 찾아내기 어려운 **임의의 형태(arbitrarily shaped)**를 가진 군집도 잘 찾아내며, 어떤 군집에도 속하지 않는 **노이즈(noise) 또는 이상치(outlier)**를 구분해낼 수 있다는 큰 장점이 있습니다.

## 1. DBSCAN의 핵심 개념

DBSCAN을 이해하기 위해서는 세 가지 핵심 용어와 두 개의 하이퍼파라미터를 알아야 합니다.

- **`eps` (epsilon, 입실론)**: 개별 데이터 포인트를 중심으로 하는 이웃 영역의 반경(radius)을 정의하는 거리 값입니다.
- **`min_samples` (또는 MinPts)**: 하나의 군집으로 인정받기 위해 `eps` 반경 내에 있어야 하는 최소 데이터 포인트의 개수입니다.

- **핵심 포인트 (Core Point)**:
  - `eps` 반경 내에 자기 자신을 포함하여 `min_samples` 개 이상의 데이터 포인트를 가지고 있는 점입니다.
  - 이 점들은 군집의 '핵심' 또는 '중심부'를 형성합니다.

- **경계 포인트 (Border Point)**:
  - `eps` 반경 내에 `min_samples` 개 미만의 데이터 포인트를 가지고 있지만, **다른 핵심 포인트의 `eps` 반경 내에는 속하는** 점입니다.
  - 이 점들은 군집의 '가장자리' 또는 '경계'에 위치합니다.

- **노이즈 포인트 (Noise Point / Outlier)**:
  - 핵심 포인트도, 경계 포인트도 아닌 점입니다.
  - 즉, 어떤 핵심 포인트의 `eps` 반경 내에도 속하지 않는 점으로, 어떤 군집에도 포함되지 않는 이상치로 간주됩니다.


## 2. DBSCAN 알고리즘의 동작 원리

1.  아직 방문하지 않은 임의의 데이터 포인트를 선택합니다.
2.  선택한 포인트의 `eps` 반경 내에 있는 모든 이웃 포인트들을 찾습니다.
3.  이웃 포인트의 수가 `min_samples`보다 크거나 같으면, 해당 포인트를 **핵심 포인트**로 지정하고 새로운 군집을 형성합니다.
4.  이 새로운 군집에 대해, 핵심 포인트의 모든 이웃들을 재귀적으로 탐색합니다. 이웃이 또 다른 핵심 포인트이면, 그 이웃의 이웃들까지 군집에 추가하는 방식으로 **군집을 확장**합니다. (이를 '밀도-연결(density-connected)'된 포인트들을 찾는다고 합니다.)
5.  만약 이웃 포인트의 수가 `min_samples`보다 작으면, 해당 포인트를 일단 **노이즈 포인트**로 지정합니다. (이 포인트는 나중에 다른 군집의 경계 포인트가 될 수도 있습니다.)
6.  모든 데이터 포인트를 방문할 때까지 1~5번 과정을 반복합니다.

## 3. 하이퍼파라미터 설정

DBSCAN의 성능은 `eps`와 `min_samples` 두 하이퍼파라미터에 크게 좌우됩니다.
- **`eps`**: 이 값이 너무 작으면 대부분의 데이터가 노이즈로 처리될 수 있습니다. 반대로 너무 크면, 서로 다른 군집들이 하나로 합쳐져 버릴 수 있습니다.
- **`min_samples`**: 이 값이 클수록 더 밀도가 높은 영역을 군집으로 정의하게 되어, 노이즈에 대해 더 강건한 모델이 됩니다. 일반적으로 데이터의 차원(D)을 고려하여 `min_samples >= D+1`로 설정하며, `2*D`를 시작점으로 사용하는 경우가 많습니다.

적절한 `eps` 값을 찾기 위해, k-NN을 활용하여 각 포인트로부터 k번째(이때 k=`min_samples`)로 가까운 이웃까지의 거리를 계산하고, 이 거리들을 정렬하여 그래프로 그린 뒤 기울기가 급격하게 변하는 지점(elbow)을 찾는 방법이 사용되기도 합니다.

## 4. DBSCAN의 장단점

### 장점
- **임의 형태의 군집 탐지**: K-평균과 달리 원형이 아닌 복잡한 모양의 군집도 잘 찾아냅니다.
- **노이즈 식별**: 이상치를 군집에 포함시키지 않고 노이즈로 구분하여 모델의 강건성을 높입니다.
- **사전 군집 개수 불필요**: K-평균과 달리 군집의 개수를 미리 지정할 필요가 없습니다.

### 단점
- **하이퍼파라미터 민감성**: `eps`와 `min_samples` 값에 따라 군집 결과가 크게 달라져, 적절한 값을 찾는 것이 중요합니다.
- **밀도가 다른 군집 처리의 어려움**: 데이터셋 내에 밀도가 매우 다른 군집들이 섞여 있을 경우, 하나의 `eps`와 `min_samples` 설정으로는 모든 군집을 효과적으로 찾아내기 어렵습니다. (예: 밀도가 낮은 군집은 노이즈로 처리될 수 있음)
- **고차원 데이터**: 차원이 매우 높아지면(차원의 저주), 데이터 간의 거리 계산이 무의미해져 밀도 기반의 접근 방식이 잘 동작하지 않을 수 있습니다.

---

## 예제 및 풀이 (Examples and Solutions)

### 예제 1: 포인트 유형 식별하기

**문제:** 아래 그림은 `min_samples=4`로 설정했을 때의 데이터 분포를 보여줍니다. 각 포인트 A, B, C, N이 핵심 포인트, 경계 포인트, 노이즈 포인트 중 어디에 해당하는지 설명하시오.

![DBSCAN Concepts](https://upload.wikimedia.org/wikipedia/commons/thumb/a/af/DBSCAN-density-based-clustering.svg/400px-DBSCAN-density-based-clustering.svg.png)
*(이미지 출처: 위키미디어)*

**풀이:**

1.  **포인트 A (핵심 포인트):**
    - A의 `eps` 반경(붉은 원) 안에 자기 자신을 포함하여 4개 이상의 포인트(A를 포함한 붉은색 포인트들)가 존재합니다.
    - `min_samples` 조건(4개 이상)을 만족하므로, A는 **핵심 포인트(Core Point)**입니다.

2.  **포인트 B (경계 포인트):**
    - B의 `eps` 반경 안에는 자기 자신을 포함하여 3개의 포인트만 존재합니다. 따라서 `min_samples` 조건을 만족하지 못해 핵심 포인트는 아닙니다.
    - 하지만, B는 다른 핵심 포인트(예: A)의 반경 내에 포함됩니다.
    - 따라서, B는 **경계 포인트(Border Point)**입니다.

3.  **포인트 N (노이즈 포인트):**
    - N의 `eps` 반경 안에는 자기 자신 외에 다른 포인트가 없습니다. `min_samples` 조건을 만족하지 못합니다.
    - 또한, N은 다른 어떤 핵심 포인트의 반경 내에도 포함되지 않습니다.
    - 따라서, N은 **노이즈 포인트(Noise Point)**입니다.

4.  **포인트 C (경계 포인트):**
    - B와 마찬가지로, C 자체는 `min_samples` 조건을 만족하지 못하지만, 근처에 있는 다른 핵심 포인트의 반경 내에 속하므로 **경계 포인트(Border Point)**입니다.

**결론:**
DBSCAN은 이와 같이 각 포인트의 '밀도'를 기준으로 역할을 부여하고, 핵심 포인트들을 서로 연결(density-connected)하여 군집을 확장해 나가는 방식으로 동작합니다.
